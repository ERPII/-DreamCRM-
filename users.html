<!DOCTYPE html>
<html lang="he" dir="rtl">
<head><meta charset="UTF-8"><script src="https://cdn.tailwindcss.com"></script><title> 注</title></head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-black mb-8 text-indigo-800">转拽 注  </h1>
        <div id="usersList" class="space-y-4"></div>
    </div>

    <script type="module" src="app.js"></script>
    <script type="module">
        import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        async function loadUsers() {
            const querySnapshot = await getDocs(collection(window.db, "users"));
            document.getElementById('usersList').innerHTML = querySnapshot.docs.map(doc => {
                const data = doc.data();
                return `
                <div class="bg-white p-6 rounded-2xl shadow-md border-r-4 border-indigo-500">
                    <div class="flex justify-between">
                        <h3 class="font-bold text-lg">${data.name} <span class="text-sm font-normal text-gray-400">(${data.role})</span></h3>
                        <button onclick="editEmp('${doc.id}', '${data.notes || ''}')" class="text-indigo-600 underline text-sm">注专 转拽 注</button>
                    </div>
                    <p class="mt-2 text-gray-600 text-sm italic">住 : ${data.notes || '拽...'}</p>
                </div>`;
            }).join('');
        }

        window.editEmp = async (id, oldNote) => {
            const note = prompt("专砖 注 驻 注 注:", oldNote);
            if(note !== null) {
                await window.DreamCRM.updateInfo("users", id, note);
                loadUsers();
            }
        };
        window.onload = loadUsers;
    </script>
</body>
</html>
