<div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-black mb-10 border-r-4 border-yellow-500 pr-4"> 爪转 砖 砖 </h1>
    <div id="staffList" class="grid gap-6"></div>
</div>

<script type="module">
    import { collection, getDocs, updateDoc, doc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    async function loadStaff() {
        const snap = await getDocs(collection(window.db, "users"));
        document.getElementById('staffList').innerHTML = snap.docs.map(d => {
            const u = d.data();
            const history = u.history || [];
            return `
            <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100 flex flex-col md:flex-row gap-8">
                <div class="w-20 h-20 bg-slate-800 rounded-2xl flex items-center justify-center text-3xl text-white font-black shrink-0">
                    ${u.name.charAt(0)}
                </div>
                <div class="flex-1">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-slate-800">${u.name}</h3>
                            <p class="text-blue-500 font-medium">${u.role === 'admin' ? ' 专砖' : '爪转 专转/砖专转'}</p>
                        </div>
                    </div>
                    
                    <div class="bg-amber-50 rounded-2xl p-4 mb-4 border border-amber-100">
                        <h4 class="text-xs font-bold text-amber-700 mb-3 italic">注  转拽 砖:</h4>
                        <div class="space-y-2">
                            ${history.map(h => `<div class="text-xs text-slate-700 bg-white/50 p-2 rounded-lg border-r-2 border-amber-400"> ${h}</div>`).join('') || '转拽 拽 -  注'}
                        </div>
                    </div>

                    <div class="flex gap-2">
                        <input id="hist-${d.id}" placeholder="住祝 注专转 ..." class="flex-1 bg-white border border-slate-200 rounded-xl p-2 text-sm">
                        <button onclick="addHistory('${d.id}')" class="bg-amber-500 text-white px-4 py-2 rounded-xl text-xs font-bold shadow-md">砖专 转拽</button>
                    </div>
                </div>
            </div>`;
        }).join('');
    }

    window.addHistory = async (id) => {
        const input = document.getElementById(`hist-${id}`);
        if (!input.value) return;
        await updateDoc(doc(window.db, "users", id), {
            history: arrayUnion(input.value)
        });
        input.value = "";
        loadStaff();
    };

    window.onload = loadStaff;
</script>
