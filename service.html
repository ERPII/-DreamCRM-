<div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-black mb-8 text-red-600 text-center">××¨×›×– ×ª××™×›×” ×•×©×™×¨×•×ª ğŸ› ï¸</h1>
    
    <div id="ticketsGrid" class="space-y-6">
        </div>
</div>

<script type="module">
    import { collection, getDocs, updateDoc, doc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    async function loadTickets() {
        const grid = document.getElementById('ticketsGrid');
        const snap = await getDocs(collection(window.db, "tickets"));
        
        grid.innerHTML = snap.docs.map(d => {
            const t = d.data();
            const logs = t.logs || [];
            return `
            <div class="bg-white rounded-3xl shadow-xl overflow-hidden border border-slate-100">
                <div class="bg-red-600 p-4 text-white flex justify-between items-center">
                    <span class="font-bold">×§×¨×™××” #${d.id.slice(0,5)}</span>
                    <span class="text-xs opacity-80">${t.customer}</span>
                </div>
                <div class="p-6">
                    <h2 class="text-xl font-black mb-4">${t.issue}</h2>
                    
                    <div class="space-y-3 mb-6">
                        <p class="text-xs font-bold text-slate-400">×”×™×¡×˜×•×¨×™×™×ª ×˜×™×¤×•×œ (×¢×“ 13 ×¢×“×›×•× ×™× ××•××œ×¥):</p>
                        ${logs.map(log => `
                            <div class="flex gap-3 items-center">
                                <div class="w-2 h-2 bg-red-400 rounded-full"></div>
                                <div class="text-sm text-slate-600">${log}</div>
                            </div>
                        `).join('') || '<p class="text-gray-300 italic text-sm">×××ª×™×Ÿ ×œ×ª×—×™×œ×ª ×˜×™×¤×•×œ...</p>'}
                    </div>

                    <div class="flex gap-3">
                        <input id="log-${d.id}" placeholder="××” ×‘×•×¦×¢ ×›×¢×ª?" class="flex-1 bg-slate-50 border rounded-xl p-3 outline-none focus:border-red-500 transition">
                        <button onclick="addLog('${d.id}')" class="bg-red-600 text-white px-6 rounded-xl font-bold">×©×œ×— ×¢×“×›×•×Ÿ</button>
                    </div>
                </div>
            </div>`;
        }).join('');
    }

    window.addLog = async (id) => {
        const input = document.getElementById(`log-${id}`);
        if (!input.value) return;

        const ref = doc(window.db, "tickets", id);
        const date = new Date().toLocaleDateString('he-IL');
        await updateDoc(ref, {
            logs: arrayUnion(`${date} - ${input.value}`)
        });
        input.value = "";
        loadTickets();
    };

    window.onload = loadTickets;
</script>
