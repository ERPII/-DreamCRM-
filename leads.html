<div class="max-w-5xl mx-auto">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-black text-slate-800">× ×™×”×•×œ ×œ×™×“×™× ×—×›× ğŸ¯</h1>
        <button onclick="addNewLead()" class="bg-blue-600 text-white px-6 py-3 rounded-2xl font-bold shadow-lg">+ ×œ×™×“ ×—×“×©</button>
    </div>

    <div id="leadsContainer" class="grid gap-6">
        </div>
</div>

<script type="module">
    import { collection, getDocs, addDoc, updateDoc, doc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    async function loadLeads() {
        const container = document.getElementById('leadsContainer');
        const snap = await getDocs(collection(window.db, "leads"));
        
        container.innerHTML = snap.docs.map(d => {
            const lead = d.data();
            const updates = lead.updates || [];
            return `
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="text-xl font-bold">${lead.name}</h3>
                        <p class="text-sm text-slate-400">${lead.phone || '×œ×œ× ×˜×œ×¤×•×Ÿ'}</p>
                    </div>
                    <span class="bg-blue-100 text-blue-700 text-xs px-3 py-1 rounded-full font-bold">×œ×™×“ ×—×“×©</span>
                </div>
                
                <div class="bg-slate-50 rounded-2xl p-4 mb-4 max-h-40 overflow-y-auto">
                    <h4 class="text-xs font-bold text-slate-400 mb-2 uppercase">×¦×™×¨ ×–××Ÿ ×¢×“×›×•× ×™× (${updates.length})</h4>
                    <div class="space-y-2">
                        ${updates.map(u => `<div class="text-sm border-r-2 border-blue-400 pr-2 py-1 bg-white rounded shadow-sm">${u}</div>`).join('') || '<p class="text-gray-400 text-xs">××™×Ÿ ×¢×“×›×•× ×™× ×¢×“×™×™×Ÿ</p>'}
                    </div>
                </div>

                <div class="flex gap-2">
                    <input id="upd-${d.id}" placeholder="×”×•×¡×£ ×¢×“×›×•×Ÿ ×—×“×©..." class="flex-1 bg-slate-100 border-none rounded-xl p-2 text-sm focus:ring-2 focus:ring-blue-500">
                    <button onclick="addUpdate('${d.id}')" class="bg-slate-800 text-white px-4 py-2 rounded-xl text-sm font-bold">×¢×“×›×Ÿ</button>
                </div>
            </div>`;
        }).join('');
    }

    window.addUpdate = async (id) => {
        const input = document.getElementById(`upd-${id}`);
        if (!input.value) return;
        
        const leadRef = doc(window.db, "leads", id);
        const time = new Date().toLocaleTimeString('he-IL', {hour: '2-digit', minute:'2-digit'});
        await updateDoc(leadRef, {
            updates: arrayUnion(`${time}: ${input.value}`)
        });
        input.value = "";
        loadLeads();
    };

    window.addNewLead = async () => {
        const name = prompt("×©× ×”×œ×™×“:");
        if(name) {
            await addDoc(collection(window.db, "leads"), { name, updates: [], timestamp: new Date() });
            loadLeads();
        }
    };

    window.onload = loadLeads;
</script>
