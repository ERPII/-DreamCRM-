<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>DreamCRM - ×“××©×‘×•×¨×“ × ×™×”×•×œ×™</title>
</head>
<body class="bg-gray-100 flex h-screen overflow-hidden">

    <aside class="w-64 bg-slate-900 text-white flex flex-col p-6 shadow-2xl">
        <div class="text-2xl font-black mb-10 text-blue-400 border-b border-slate-700 pb-4 italic">DreamCRM ğŸš€</div>
        <nav class="flex-1 space-y-2">
            <a href="dashboard.html" class="block p-3 rounded-lg bg-blue-600 font-bold">ğŸ“Š ×“××©×‘×•×¨×“</a>
            <a href="leads.html" class="block p-3 rounded-lg hover:bg-slate-800 transition">ğŸ¯ × ×™×”×•×œ ×œ×™×“×™×</a>
            <a href="customers.html" class="block p-3 rounded-lg hover:bg-slate-800 transition">ğŸ‘¥ ×œ×§×•×—×•×ª</a>
            <a href="products.html" class="block p-3 rounded-lg hover:bg-slate-800 transition">ğŸ·ï¸ ××—×™×¨×•×Ÿ ××•×¦×¨×™×</a>
            <a href="service.html" class="block p-3 rounded-lg hover:bg-slate-800 transition">ğŸ› ï¸ ×§×¨×™××•×ª ×©×™×¨×•×ª</a>
            <a href="reports.html" class="block p-3 rounded-lg hover:bg-slate-800 transition text-green-400">ğŸ“ˆ ×“×•×—×•×ª (35 ×¡×•×’×™×)</a>
            <a id="adminLink" href="users.html" class="hidden block p-3 rounded-lg border border-yellow-500/30 text-yellow-500 hover:bg-yellow-500 hover:text-white transition mt-10">ğŸ” × ×™×”×•×œ ×¢×•×‘×“×™×</a>
        </nav>
        <button onclick="window.DreamCRM.logout().then(() => location.href='index.html')" class="p-3 bg-red-600/20 text-red-400 border border-red-600/50 rounded-xl hover:bg-red-600 hover:text-white transition">×”×ª× ×ª×§</button>
    </aside>

    <main class="flex-1 p-10 overflow-y-auto">
        <header class="flex justify-between items-center mb-10">
            <div>
                <h1 class="text-4xl font-black text-slate-800">×©×œ×•×, <span id="userNameDisplay" class="text-blue-600">...</span> ğŸ‘‹</h1>
                <p class="text-gray-500 font-medium">×”× ×” ××” ×©×§×•×¨×” ×‘×¢×¡×§ ×©×œ×š ×”×™×•×</p>
            </div>
            <div id="statusBadge" class="px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-bold shadow-sm">××—×•×‘×¨ ×œ×¢× ×Ÿ</div>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
            <div class="bg-white p-8 rounded-3xl shadow-sm border-b-4 border-blue-500 transform hover:scale-105 transition">
                <h3 class="text-gray-400 font-bold uppercase text-xs tracking-wider">×œ×™×“×™× ×—×“×©×™×</h3>
                <p class="text-5xl font-black text-slate-800 mt-2" id="countLeads">0</p>
            </div>
            <div class="bg-white p-8 rounded-3xl shadow-sm border-b-4 border-green-500 transform hover:scale-105 transition">
                <h3 class="text-gray-400 font-bold uppercase text-xs tracking-wider">×œ×§×•×—×•×ª ×¤×¢×™×œ×™×</h3>
                <p class="text-5xl font-black text-slate-800 mt-2" id="countCustomers">0</p>
            </div>
            <div class="bg-white p-8 rounded-3xl shadow-sm border-b-4 border-red-500 transform hover:scale-105 transition">
                <h3 class="text-gray-400 font-bold uppercase text-xs tracking-wider">×§×¨×™××•×ª ×¤×ª×•×—×•×ª</h3>
                <p class="text-5xl font-black text-slate-800 mt-2" id="countTickets">0</p>
            </div>
        </div>

        <div class="bg-white p-8 rounded-3xl shadow-sm">
            <h2 class="text-xl font-bold mb-6 border-b pb-4">×¤×¢×•×œ×•×ª ××”×™×¨×•×ª</h2>
            <div class="flex gap-4">
                <button onclick="location.href='leads.html'" class="bg-blue-50 text-blue-600 px-6 py-3 rounded-2xl font-bold hover:bg-blue-600 hover:text-white transition">ğŸ¯ ×”×•×¡×£ ×œ×™×“ ×—×“×©</button>
                <button onclick="location.href='service.html'" class="bg-red-50 text-red-600 px-6 py-3 rounded-2xl font-bold hover:bg-red-600 hover:text-white transition">ğŸ› ï¸ ×¤×ª×— ×§×¨×™××ª ×©×™×¨×•×ª</button>
                <button onclick="location.href='reports.html'" class="bg-green-50 text-green-600 px-6 py-3 rounded-2xl font-bold hover:bg-green-600 hover:text-white transition">ğŸ“Š ×”×¤×§ ×“×•×— ×—×•×“×©×™</button>
            </div>
        </div>
    </main>

    <script type="module" src="app.js"></script>
    <script type="module">
        import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ×¤×•× ×§×¦×™×™×ª ×˜×¢×™× ×ª × ×ª×•× ×™×
        async function initDashboard() {
            window.DreamCRM.checkUserStatus(async (user) => {
                if (!user) {
                    window.location.href = 'index.html';
                    return;
                }

                // ×”×¦×’×ª ×©× ×”××©×ª××© ×•×”×¨×©××•×ª
                document.getElementById('userNameDisplay').innerText = user.name;
                if (user.role === 'admin') {
                    document.getElementById('adminLink').classList.remove('hidden');
                }

                // ××©×™×›×ª ××¡×¤×¨×™× ××”×¢× ×Ÿ (Firebase)
                const leadsSnap = await getDocs(collection(window.db, "leads"));
                const custSnap = await getDocs(collection(window.db, "customers"));
                const tickSnap = await getDocs(collection(window.db, "tickets"));

                document.getElementById('countLeads').innerText = leadsSnap.size;
                document.getElementById('countCustomers').innerText = custSnap.size;
                document.getElementById('countTickets').innerText = tickSnap.size;
            });
        }

        window.onload = initDashboard;
    </script>
</body>
</html>
