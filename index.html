<div class="max-w-5xl mx-auto">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-black">  </h1>
        <div class="flex gap-2">
            <input type="file" id="excelIn" class="hidden" accept=".xlsx">
            <label for="excelIn" class="bg-green-600 text-white px-4 py-2 rounded-xl cursor-pointer"> 拽住</label>
        </div>
    </div>

    <div class="mb-6 relative">
        <input type="text" id="searchInput" placeholder="驻砖 驻 砖, 驻,   砖 注住拽..." 
               class="w-full p-4 pr-12 rounded-2xl border-none shadow-sm focus:ring-2 focus:ring-blue-500 outline-none">
        <span class="absolute right-4 top-4 opacity-30 text-xl"></span>
    </div>

    <div id="list" class="grid gap-4"></div>
</div>

<script type="module">
    import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    let allLeads = [];

    async function load() {
        const snap = await getDocs(collection(window.db, "leads"));
        allLeads = snap.docs.map(d => ({id: d.id, ...d.data()}));
        render(allLeads);
    }

    function render(data) {
        document.getElementById('list').innerHTML = data.map(l => `
            <div class="bg-white p-6 rounded-2xl shadow-sm flex justify-between items-center">
                <div>
                    <h3 class="font-bold text-lg">${l.name}</h3>
                    <p class="text-sm text-gray-500">${l.businessName || '注住拽  爪'} | ${l.phone || ''}</p>
                </div>
                <button class="text-blue-600 font-bold">爪驻 转拽</button>
            </div>
        `).join('');
    }

    // 驻注转 驻砖  转
    document.getElementById('searchInput').oninput = (e) => {
        const filtered = window.DreamCRM.filterData(allLeads, e.target.value);
        render(filtered);
    };

    document.getElementById('excelIn').onchange = async (e) => {
        await window.DreamCRM.importLeadsFromExcel(e.target.files[0]);
        load();
    };

    window.onload = load;
</script>
